name: Django Integracao Continua

on: 
  push: 
    branches:
      - main

jobs: 
  build:
    runs-on: ubuntu-latest

    steps:
    - name: checkout
      uses: actions/checkout@v1
    
    #- name: Install SSH Key
    #   uses: shimataro/ssh-key-action@v2
    #   with:
    #     key: ${{ secrets.ssh_key }} 
    #     known_hosts: 'just-a-placeholder-so-we-dont-get-errors'

    # - name: Adding Known Hosts
    #   run: ssh-keyscan -H ${{ secrets.ssh_host }} >> /root/known_hosts

    - name: Verificando versao do python 3.9.6
      uses: actions/setup-python@v2
      with:
        python-version: 3.9.6
    - name: executing remote ssh commands using password
      with:
        host: 31.220.48.246
        username: root
        password: Jefersonqueiroga123#
        port: 22
        script: whoami
    - name: Instalando dependencias
      run: |
        source venv/bin/activate
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Fazendo migrate
      run: |
        python3 manage.py migrate
    - name: Rodando server de novo
      run: |
        sudo systemctl restart gunicorn
        sudo systemctl restart nginx
